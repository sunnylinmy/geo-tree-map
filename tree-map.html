<!DOCTYPE HTML>
<html>
  <head>
    <!-- Set the character encoding -->
    <meta charset="UTF-8">
    
    <!-- CSS -->
    <link type="text/css" rel="stylesheet" href="style.css" />
    
    <!-- Javascript -->
    <script type="text/javascript" src="scripts/protovis-r3.2.js"></script>
    <script type="text/javascript" src="stateOccupationData.js"></script>
    
    <!-- Title -->
    <title>Tree Map</title>
    
  </head>
  <body>
    <div id="fig">
      <script type="text/javascript">

// This function retrieves the data for the desired measure, level, and state
// If state is undefined, then an array with the data for all states is returned
function getData(measure, level, state) {
  if (state) {
    return stateOccupationData[measure + "_" + level][state];
  } else {
    return stateOccupationData[measure + "_" + level];
  }
}

// These variables configure the visualization
var measures = ["annualMeanWage","ann10Wage","ann25Wage","ann50Wage","ann75Wage","ann90Wage","total"];

var measureIndex = 5,
    level = 3,
    state = "OH";

var currentHover = -1;

var w = 800,
    h = 600,
    color = pv.Colors.category19().by(function(d) {
      switch (level) {
        case 1:
        case 2:
          return d.nodeName;
          break;
        case 3:
          return d.parentNode.nodeName;
          break;
      }
    }),
    nodes = pv.dom(getData(measures[measureIndex], level, state)).nodes();

var vis = new pv.Panel()
    .width(w)
    .height(h)
    .top(10);

var treemap = vis.add(pv.Layout.Treemap)
    .nodes(nodes)
    .round(false)
    .padding(1);

treemap.leaf.add(pv.Panel)
    .fillStyle(function(d) { return d.index == currentHover ? color(d).brighter() : color(d); })
    .strokeStyle("white")
    .lineWidth(1)
    .antialias(false)
    .event("mouseover", function(d) { currentHover = d.index; return this; })
    .event("mouseout", function() { currentHover = -1; return this; });

treemap.label.add(pv.Label)
    .visible(function(d) {return d.parentNode && !d.parentNode.nodeName; })
    .textAngle(0)
    .textAlign("left")
    .textBaseline("top")
    .left(function(d) { return d.x; })
    .top(function(d) { return d.y; })
    .text(function(d) { return d.nodeName.substring(0,d.dx/10) + "..."; });

vis.render();

      </script>
    </div>
  </body>
</html>
